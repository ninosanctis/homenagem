---
import Layout from "../layouts/Layout.astro";
import "../styles/global.css";
import { SlArrowLeft, SlArrowRight } from "react-icons/sl";
---

<Layout>
  <div class="w-full max-w-full sm:max-w-6xl p-4 sm:p-8 md:p-14">

    <!-- TÍTULO -->
    <h1 class="text-2xl sm:text-4xl md:text-5xl font-bold text-center mb-8 sm:mb-16">
      Obrigado por toda nossa história!
    </h1>

    <!-- ================= CARROSSEL ================= -->
    <div class="w-full max-w-4xl mx-auto mb-12">

      <div
        class="relative overflow-hidden rounded-xl
               bg-white/10 backdrop-blur-md
               border border-white/20
               h-[320px] sm:h-[420px]"
      >

        <!-- TRACK -->
        <div
          id="carouselTrack"
          class="flex h-full transition-transform duration-500 ease-in-out"
        >

          <!-- CLONE ÚLTIMA -->
          <div class="w-full flex-shrink-0 flex items-center justify-center">
            <img src="/foto5.png" class="max-h-full max-w-full object-contain" />
          </div>

          <!-- SLIDES REAIS -->
          <div class="w-full flex-shrink-0 flex items-center justify-center">
            <img src="/foto4.png" class="max-h-full max-w-full object-contain" />
          </div>

          <div class="w-full flex-shrink-0 flex items-center justify-center">
            <img src="/foto2.png" class="max-h-full max-w-full object-contain" />
          </div>

          <div class="w-full flex-shrink-0 flex items-center justify-center">
            <img src="/foto3.png" class="max-h-full max-w-full object-contain" />
          </div>

          <div class="w-full flex-shrink-0 flex items-center justify-center">
            <img src="/foto4.png" class="max-h-full max-w-full object-contain" />
          </div>

          <div class="w-full flex-shrink-0 flex items-center justify-center">
            <img src="/foto2.png" class="max-h-full max-w-full object-contain" />
          </div>

          <!-- CLONE PRIMEIRA -->
          <div class="w-full flex-shrink-0 flex items-center justify-center">
            <img src="/foto1.png" class="max-h-full max-w-full object-contain" />
          </div>

        </div>

        <!-- BOTÃO ESQUERDA -->
        <button
          id="prev"
          class="absolute left-3 top-1/2 -translate-y-1/2
                 bg-gray-900/70 hover:bg-gray-900
                 p-2 sm:p-3 rounded-full text-white"
        >
          <SlArrowLeft size={18} />
        </button>

        <!-- BOTÃO DIREITA -->
        <button
          id="next"
          class="absolute right-3 top-1/2 -translate-y-1/2
                 bg-gray-900/70 hover:bg-gray-900
                 p-2 sm:p-3 rounded-full text-white"
        >
          <SlArrowRight size={18} />
        </button>
      </div>

      <!-- DOTS -->
      <div id="dots" class="flex justify-center gap-2 mt-4"></div>
    </div>
    <!-- ================= FIM CARROSSEL ================= -->

    <!-- TIMER -->
    <div class="text-center mb-16">
      <h2 class="text-2xl font-semibold mb-4">Nossa história</h2>
      <div
        id="timer"
        class="inline-block text-sm sm:text-lg font-mono
               px-4 sm:px-6 py-3 sm:py-4
               rounded-lg bg-gray-800 shadow-lg">
      </div>
    </div>

    <!-- HOMENAGEM -->
    <div class="max-w-2xl mx-auto text-center
                bg-white text-gray-800
                p-4 sm:p-8 rounded-xl shadow-lg">
      <h2 class="text-xl sm:text-2xl font-semibold mb-4">Te amarei até o fim</h2>
      <p class="text-sm sm:text-base">
        Aqui você pode escrever sua homenagem.
      </p>
    </div>

  </div>

  <!-- ================= JS ================= -->
  <script>
    // ---------- CARROSSEL INFINITO ----------
    const track = document.getElementById("carouselTrack");
    const slides = Array.from(track.children);
    const dotsContainer = document.getElementById("dots");

    const totalSlides = slides.length;
    const realSlides = totalSlides - 2;

    let index = 1; // começa no primeiro slide real
    let startX = 0;

    track.style.transform = `translateX(-${index * 100}%)`;

    // Criar dots (somente slides reais)
    for (let i = 0; i < realSlides; i++) {
      const dot = document.createElement("button");
      dot.className = "w-2.5 h-2.5 rounded-full bg-gray-400 transition-colors";
      dot.addEventListener("click", () => {
        index = i + 1;
        updateCarousel();
      });
      dotsContainer.appendChild(dot);
    }

    const dots = Array.from(dotsContainer.children);

    function updateDots() {
      const realIndex = (index - 1 + realSlides) % realSlides;
      dots.forEach((dot, i) => {
        dot.classList.toggle("bg-white", i === realIndex);
        dot.classList.toggle("bg-gray-400", i !== realIndex);
      });
    }

    function updateCarousel(animate = true) {
      track.style.transition = animate
        ? "transform 0.5s ease-in-out"
        : "none";

      track.style.transform = `translateX(-${index * 100}%)`;
      updateDots();
    }

    function nextSlide() {
      index++;
      updateCarousel();
    }

    function prevSlide() {
      index--;
      updateCarousel();
    }

    track.addEventListener("transitionend", () => {
      if (index === totalSlides - 1) {
        index = 1;
        updateCarousel(false);
      }

      if (index === 0) {
        index = totalSlides - 2;
        updateCarousel(false);
      }
    });

    document.getElementById("next").addEventListener("click", nextSlide);
    document.getElementById("prev").addEventListener("click", prevSlide);

    // Swipe mobile
    track.addEventListener("touchstart", e => {
      startX = e.touches[0].clientX;
    }, { passive: true });

    track.addEventListener("touchend", e => {
      const diff = e.changedTouches[0].clientX - startX;
      if (Math.abs(diff) > 50) diff < 0 ? nextSlide() : prevSlide();
    });

    updateDots();

    // ---------- TIMER ----------
    function updateTimer() {
      const startDate = new Date("2021-11-06T00:00:00");
      const now = new Date();
      const diff = now - startDate;

      const totalDays = Math.floor(diff / (1000 * 60 * 60 * 24));
      const years = Math.floor(totalDays / 365);
      const months = Math.floor((totalDays % 365) / 30);
      const days = totalDays % 30;
      const hours = Math.floor((diff / (1000 * 60 * 60)) % 24);
      const minutes = Math.floor((diff / (1000 * 60)) % 60);
      const seconds = Math.floor((diff / 1000) % 60);

      document.getElementById("timer").textContent =
        `${years} anos, ${months} meses, ${days} dias, ${hours} horas, ${minutes} minutos, ${seconds} segundos`;
    }

    updateTimer();
    setInterval(updateTimer, 1000);
  </script>
</Layout>
