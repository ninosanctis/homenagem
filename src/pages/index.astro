---
import Layout from "../layouts/Layout.astro";
import "../styles/global.css";
import { SlArrowLeft, SlArrowRight } from "react-icons/sl";
---

<Layout>
  <div class="w-full max-w-full sm:max-w-6xl p-4 sm:p-8 md:p-14">

    <!-- TÍTULO -->
    <h1 class="text-2xl sm:text-4xl md:text-5xl font-bold text-center mb-8 sm:mb-16">
      Obrigado por toda nossa história!
    </h1>

    <!-- CARROSSEL -->
    <div class="relative w-full flex items-center justify-center mb-8 sm:mb-20
                overflow-hidden bg-white/10 backdrop-blur-md
                border border-white/20 rounded-lg p-2 sm:p-4">

      <!-- BOTÃO ESQUERDA -->
      <button id="prev"
        class="absolute left-2 sm:left-4 z-20 bg-gray-900/80 hover:bg-gray-700
               p-2 sm:p-3 rounded-full">
        <SlArrowLeft size={18} />
      </button>

      <!-- TRACK -->
      <div
        id="carouselTrack"
        class="flex items-center justify-center gap-4 sm:gap-8
               w-full p-4 sm:p-8 md:p-20 overflow-hidden touch-pan-y"
      >

        <!-- CARD -->
        <div class="carousel-card
            w-40 aspect-[9/16]
            sm:w-44
            rounded-xl bg-black/20
            overflow-hidden flex items-center justify-center">
          <img src="/foto4.png" class="w-full h-full object-cover" />
        </div>

        <div class="carousel-card
            w-40 aspect-[9/16]
            sm:w-44
            rounded-xl bg-black/20
            overflow-hidden flex items-center justify-center">
          <img src="/foto2.png" class="w-full h-full object-cover" />
        </div>

        <div class="carousel-card
            w-40 aspect-[9/16]
            sm:w-44
            rounded-xl bg-black/20
            overflow-hidden flex items-center justify-center">
          <img src="/foto3.png" class="w-full h-full object-cover" />
        </div>

        <div class="carousel-card
            w-40 aspect-[9/16]
            sm:w-44
            rounded-xl bg-black/20
            overflow-hidden flex items-center justify-center">
          <img src="/foto4.png" class="w-full h-full object-cover" />
        </div>

        <div class="carousel-card
            w-40 aspect-[9/16]
            sm:w-44
            rounded-xl bg-black/20
            overflow-hidden flex items-center justify-center">
          <img src="/foto2.png" class="w-full h-full object-cover" />
        </div>

      </div>

      <!-- BOTÃO DIREITA -->
      <button id="next"
        class="absolute right-2 sm:right-4 z-20 bg-gray-900/80 hover:bg-gray-700
               p-2 sm:p-3 rounded-full">
        <SlArrowRight size={18} />
      </button>
    </div>

    <!-- TIMER -->
    <div class="text-center mb-16">
      <h2 class="text-2xl font-semibold mb-4">Nossa história</h2>
      <div
        id="timer"
        class="inline-block text-sm sm:text-lg font-mono px-4 sm:px-6
               py-3 sm:py-4 rounded-lg bg-gray-800 shadow-lg"
      ></div>
    </div>

    <!-- HOMENAGEM -->
    <div class="max-w-2xl mx-auto text-center bg-white text-gray-800
                p-4 sm:p-8 rounded-xl shadow-lg">
      <h2 class="text-xl sm:text-2xl font-semibold mb-4">Te amarei até o fim</h2>
      <p class="text-sm sm:text-base">
        Aqui você pode escrever sua homenagem. Substitua este texto pelo conteúdo desejado.
      </p>
    </div>

  </div>

  <!-- JS -->
  <script>
    const track = document.getElementById("carouselTrack");
    let cards = Array.from(track.children);

    let startX = 0;
    let isSwiping = false;

    function updateCarousel() {
      const centerIndex = Math.floor(cards.length / 2);

      cards.forEach((card, index) => {
        card.classList.remove(
          "scale-125", "opacity-100", "z-20",
          "scale-90", "opacity-60", "blur-sm",
          "scale-75", "opacity-30", "blur-md"
        );

        if (index === centerIndex) {
          card.classList.add("scale-125", "opacity-100", "z-20");
        } else if (index === centerIndex - 1 || index === centerIndex + 1) {
          card.classList.add("scale-90", "opacity-60", "blur-sm");
        } else {
          card.classList.add("scale-75", "opacity-30", "blur-md");
        }
      });
    }

    function nextSlide() {
      track.appendChild(cards.shift());
      cards = Array.from(track.children);
      updateCarousel();
    }

    function prevSlide() {
      track.prepend(cards.pop());
      cards = Array.from(track.children);
      updateCarousel();
    }

    document.getElementById("next").addEventListener("click", nextSlide);
    document.getElementById("prev").addEventListener("click", prevSlide);

    // SWIPE SIMPLES (MOBILE)
    track.addEventListener("touchstart", (e) => {
      startX = e.touches[0].clientX;
      isSwiping = true;
    }, { passive: true });

    track.addEventListener("touchend", (e) => {
      if (!isSwiping) return;
      const endX = e.changedTouches[0].clientX;
      const diff = endX - startX;

      if (Math.abs(diff) > 50) {
        diff < 0 ? nextSlide() : prevSlide();
      }

      isSwiping = false;
    });

    updateCarousel();

    // TIMER
    function updateTimer() {
      const startDate = new Date("2021-09-06T00:00:00");
      const now = new Date();
      const diff = now - startDate;

      const totalDays = Math.floor(diff / (1000 * 60 * 60 * 24));
      const years = Math.floor(totalDays / 365);
      const months = Math.floor((totalDays % 365) / 30);
      const days = totalDays % 30;
      const hours = Math.floor((diff / (1000 * 60 * 60)) % 24);
      const minutes = Math.floor((diff / (1000 * 60)) % 60);
      const seconds = Math.floor((diff / 1000) % 60);

      document.getElementById("timer").textContent =
        `${years} anos, ${months} meses, ${days} dias, ${hours} horas, ${minutes} minutos, ${seconds} segundos`;
    }

    updateTimer();
    setInterval(updateTimer, 1000);
  </script>
</Layout>

