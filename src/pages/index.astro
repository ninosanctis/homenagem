---
import "../styles/global.css";
---
<body class="bg-gray-100 p-2 sm:p-4 min-h-screen">

  <header class="w-full flex justify-center items-center py-4 mb-4 bg-white shadow-sm rounded-b-xl">
    <img src="/logo.png" alt="Logo da Empresa" class="h-10 sm:h-12 w-auto max-w-xs object-contain" />
  </header>

  <div class="max-w-4xl mx-auto bg-white p-2 sm:p-8 rounded-xl shadow-lg">
    <h1 class="text-xl sm:text-3xl font-bold text-center text-gray-800 mb-4 sm:mb-8">Pedido de Uniformes</h1>

    <form id="orderForm" class="space-y-4 sm:space-y-6">
      <div>
        <label for="clientName" class="block text-base sm:text-lg font-medium text-gray-700">Nome Completo</label>
        <input type="text" id="clientName" name="clientName" class="w-full p-2 sm:p-3 border border-gray-300 rounded-lg" required />
      </div>

      <div>
        <label for="clientEmail" class="block text-base sm:text-lg font-medium text-gray-700">Email</label>
        <input type="email" id="clientEmail" name="clientEmail" class="w-full p-2 sm:p-3 border border-gray-300 rounded-lg" required />
      </div>

      <div>
        <label for="orderNumber" class="block text-base sm:text-lg font-medium text-gray-700">Numero do Pedido</label>
        <input type="text" id="orderNumber" name="orderNumber" class="w-full p-2 sm:p-3 border border-gray-300 rounded-lg" required />
      </div>

      <div id="uniformsContainer" class="overflow-x-auto background-white p-2 sm:p-4 rounded-lg shadow space-y-4 sm:space-y-6">
        <!-- Uniformes serão renderizados aqui -->
      </div>

      <div class="mt-2 sm:mt-4 text-center">
        <button type="button" id="addUniform" class="bg-gray-600 text-white px-4 sm:px-6 py-2 sm:py-3 rounded-lg shadow-md transition-all duration-200 transform hover:bg-gray-700 hover:scale-105 active:scale-95 focus:outline-none focus:ring-2 focus:ring-gray-400">Adicionar Outra Camisa</button>
      </div>

      <div class="mt-4 sm:mt-8 text-center">
        <button
          type="submit"
          class="bg-blue-600 text-white px-4 sm:px-6 py-2 sm:py-3 rounded-lg transition-all duration-200 transform hover:bg-blue-700 hover:scale-105 active:scale-95 shadow focus:outline-none focus:ring-2 focus:ring-blue-400"
        >
          Enviar Pedido
        </button>
      </div>
    </form>

    <div id="statusMessage" class="mt-4 sm:mt-6 hidden text-center text-base sm:text-lg"></div>
  </div>

  <script>
    const form = document.getElementById('orderForm');
    const statusMessage = document.getElementById('statusMessage');
    const addUniformBtn = document.getElementById('addUniform');
    const uniformsContainer = document.getElementById('uniformsContainer');

    function saveFormData() {
      const uniforms = [];
      uniformsContainer.querySelectorAll('.uniform-item').forEach(item => {
        uniforms.push({
          name: item.querySelector('input[name="uniformName[]"]').value,
          number: item.querySelector('input[name="uniformNumber[]"]').value,
          size: item.querySelector('select[name="uniformSize[]"]').value
        });
      });

      const data = {
        orderNumber: form.orderNumber.value,
        clientName: form.clientName.value,
        clientEmail: form.clientEmail.value,
        uniformName: uniforms.map(u => u.name),
        uniformNumber: uniforms.map(u => u.number),
        uniformSize: uniforms.map(u => u.size)
      };

      localStorage.setItem('uniformOrder', JSON.stringify(data));
    }

    function restoreFormData() {
      const saved = localStorage.getItem('uniformOrder');
      if (!saved) {
        renderUniforms([{ name: '', number: '', size: 'P' }]);
        return;
      }
      const data = JSON.parse(saved);

      if (data.orderNumber) form.orderNumber.value = data.orderNumber;
      if (data.clientName) form.clientName.value = data.clientName;
      if (data.clientEmail) form.clientEmail.value = data.clientEmail;

      if (data.uniformName && Array.isArray(data.uniformName)) {
        const uniforms = [];
        for (let i = 0; i < data.uniformName.length; i++) {
          uniforms.push({
            name: data.uniformName[i] || '',
            number: data.uniformNumber ? data.uniformNumber[i] : '',
            size: data.uniformSize ? data.uniformSize[i] : 'P'
          });
        }
        renderUniforms(uniforms);
      } else {
        renderUniforms([{ name: '', number: '', size: 'P' }]);
      }
    }

    function renderUniforms(uniforms) {
      uniformsContainer.innerHTML = '';
      uniforms.forEach((uniform, idx) => {
        const uniformItem = document.createElement('div');
        uniformItem.classList.add('uniform-item');
        uniformItem.innerHTML = `
      <div class="bg-gray-50 border border-gray-200 rounded-lg p-3 sm:p-4 mb-3 shadow-sm">
        <div class="grid grid-cols-2 sm:grid-cols-1 gap-2 sm:gap-4 items-end">
          <div>
            <label class="block text-sm sm:text-base font-medium text-gray-700">Nome da Camisa</label>
            <input type="text" name="uniformName[]" class="w-full p-2 sm:p-3 border border-gray-300 rounded-lg" required value="${uniform.name}" />
          </div>
          <div>
            <label class="block text-sm sm:text-base font-medium text-gray-700">Número</label>
            <input type="number" name="uniformNumber[]" class="w-full p-2 sm:p-3 border border-gray-300 rounded-lg" required value="${uniform.number}" />
          </div>
          <div>
            <label class="block text-sm sm:text-base font-medium text-gray-700">Tamanho</label>
            <select name="uniformSize[]" class="w-full p-2 sm:p-3 border border-gray-300 rounded-lg" required>
              <option value="P" ${uniform.size === 'P' ? 'selected' : ''}>P</option>
              <option value="M" ${uniform.size === 'M' ? 'selected' : ''}>M</option>
              <option value="G" ${uniform.size === 'G' ? 'selected' : ''}>G</option>
              <option value="GG" ${uniform.size === 'GG' ? 'selected' : ''}>GG</option>
            </select>
          </div>
          <div class="flex items-end">
            <button type="button" class="removeUniform bg-red-500 text-white px-3 py-2 rounded-lg ml-0 sm:ml-2 w-full sm:w-auto">Remover</button>
          </div>
        </div>
      </div>
    `;
        uniformsContainer.appendChild(uniformItem);
      });

      uniformsContainer.querySelectorAll('.removeUniform').forEach((btn, idx) => {
        btn.addEventListener('click', function () {
          uniforms.splice(idx, 1);
          if (uniforms.length === 0) uniforms.push({ name: '', number: '', size: 'P' });
          renderUniforms(uniforms);
          saveFormData();
        });
      });
    }

    addUniformBtn.addEventListener('click', () => {
      const uniforms = [];
      uniformsContainer.querySelectorAll('.uniform-item').forEach(item => {
        uniforms.push({
          name: item.querySelector('input[name="uniformName[]"]').value,
          number: item.querySelector('input[name="uniformNumber[]"]').value,
          size: item.querySelector('select[name="uniformSize[]"]').value
        });
      });
      uniforms.push({ name: '', number: '', size: 'P' }); // Adiciona um novo bloco vazio
      renderUniforms(uniforms);
      saveFormData(); // Salva os dados atualizados
    });

    form.addEventListener('input', saveFormData);

    form.addEventListener('submit', (event) => {
      event.preventDefault();

      const formData = new FormData(form);
      const data = {
        orderNumber: '',
        clientName: '',
        clientEmail: '',
        uniformName: [],
        uniformNumber: [],
        uniformSize: []
      };

      formData.forEach((value, key) => {
        if (key === 'orderNumber') data.orderNumber = value;
        else if (key === 'clientName') data.clientName = value;
        else if (key === 'clientEmail') data.clientEmail = value;
        else if (key === 'uniformName[]') data.uniformName.push(value);
        else if (key === 'uniformNumber[]') data.uniformNumber.push(value);
        else if (key === 'uniformSize[]') data.uniformSize.push(value);
      });

      let message = `Pedido numero #${data.orderNumber}\n*${data.clientName}*\nEmail: ${data.clientEmail}\n------------------------------------------------\nLista\n`;
      for (let i = 0; i < data.uniformName.length; i++) {
        message += `${data.uniformName[i]} - ${data.uniformNumber[i]} - ${data.uniformSize[i]}\n`;
      }

      const phoneNumber = '553898077074';
      const waLink = `https://wa.me/${phoneNumber}?text=${encodeURIComponent(message)}`;

      saveFormData();

      statusMessage.textContent = 'Pedido enviado com sucesso para o WhatsApp!';
      statusMessage.classList.remove('hidden', 'text-red-500');
      statusMessage.classList.add('text-green-500');

      window.open(waLink, '_blank');

      setTimeout(() => {
        form.reset();
        localStorage.removeItem('uniformOrder');
        renderUniforms([{ name: '', number: '', size: 'P' }]);
        statusMessage.classList.add('hidden');
      }, 3000);
    });

    window.addEventListener('DOMContentLoaded', restoreFormData);
  </script>
</body>